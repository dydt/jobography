<div id="header">
  <h1 id="greeting">Welcome!</h1>
  <%= link_to 'User list', users_url,%>
  <%= link_to 'Job list', jobs_url,%>
</div>

<br/><br/>

<div id="map" style="width:750px; height:500px; margin:auto" > </div>

<script type="text/javascript">
  function loadKonami() {
    konami = new Konami();
    konami.code = function() {
      var greeting = document.getElementById("greeting");
      greeting.innerHTML = "Greetings, human!";
    
      /* Inject cornify (www.cornify.com), code lifted from their bookmarklet */
      var cornify_div = document.createElement('div');
      cornify_div.id = '__cornify_nodes';
      document.body.appendChild(cornify_div);
    
      var scrpt = document.createElement('script');
      scrpt.src = 'http://cornify.com/js/cornify.js';
      scrpt.onload = function() { cornify_add(); }
    
      cornify_div.appendChild(scrpt);
    }
    konami.load();
  }

  function loadmap() {
    var markers = [
    <% @rand_jobs.each do |job| %>
      new google.maps.Marker({
        position: new google.maps.LatLng(<%= job.lat %>, <%= job.long %>),
        title: "<%= job.title %>"
      }),
    <% end %>
    ];
    
    var center = new google.maps.LatLng(39.109, -94.589);

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        center = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        map.setCenter(center);
      }, function() {});
    }
    
    var options = {
      zoom: 4,
      center: center,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    
    var map = new google.maps.Map(document.getElementById("map"), options);
    
    for (var i = 0; i < markers.length; i++) {
      markers[i].setMap(map)
    }
  }
</script>

<%= javascript_include_tag 'http://maps.google.com/maps/api/js?sensor=false&callback=loadmap' %>
<%= javascript_include_tag 'konami.js', :onload => 'loadKonami()' %>