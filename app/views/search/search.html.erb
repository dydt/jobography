<h1>Search</h1>

<div id="map">
</div>

<script>
var q = "<%= @query %>";
var l = "<%= @location %>";
var query_path = "<%= results_path %>";

function loadMap() {
  var center = new google.maps.LatLng(39.109, -94.589);

  /*if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      center = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      map.setCenter(center);
    }, function() {});
  }*/
  
  var options = {
    zoom: 4,
    center: center,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    panControl: true,
    mapTypeControl: false,
    streetViewControl: true
  };
  
  var map = new google.maps.Map($("div#map").get(0), options);
  loadResults(map);
}

function loadResults(map) {
  $.ajax({
    url : query_path,
    type : 'get',
    data : {'q' : q, 'l' : l},
    
    success : function(results, req, status) {
      for (var i = 0; i < results.length; i++) {
        r = results[i].job
        var marker = new google.maps.Marker({
          map: map,
          animation: google.maps.Animation.DROP,
          position: new google.maps.LatLng(r.lat, r.long),
          title: r.title + ' - ' + r.company
        });
      }
    }
  });
}

</script>

<%= javascript_include_tag 'http://maps.google.com/maps/api/js?sensor=false&callback=loadMap' %>
