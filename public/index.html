<!DOCTYPE html>
<head>
	<title>Jobography</title>
	<style>
	
	html {
	  height: 100%;
	}
	
	body {
	  margin: 0;
	  height: 100%;
	}
	
	div#window {
	  width: 100%;
	  height: 100%;
	  overflow: hidden;
	}
	
	div#frame {
	  width: 200%;
	  height: 100%;
	  position: relative;
	}
	
	iframe {
	  width: 50%;
	  height: 100%;
	  border: none;
	}
	
	#home {	  
	  float: left;
	}
	
	#mapView {
	  float: left;
	}
	
	</style>
	
	<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js'> </script>
	
	<script>
	function transitionToResults() {
    $('div#frame').animate({
      left: '-100%'
    }, '700', function() {});
	}
	
	function transitionToHome() {
    $('div#frame').animate({
      left: '0%'
    }, '700', function() {});
	}

	
	window.onload = function() {
	  var home = $('iframe#home').contents().get(0);
	  document.title = home.title;
	  
	  $('form', home).submit(function(evt) {
	    var mapView = $('iframe#mapView').contents().get(0).defaultView;
	    var q = $('form input#q', home).val();
	    var l = $('form input#l', home).val();
	  
	    mapView.q = q;
	    mapView.l = l;
	    
	    mapView.loadResults();
	    var url = '/search?utf8=✓&q='+q+'&l='+l;
	    history.pushState({q : q, l : l}, mapView.title, url);
	    transitionToResults();
    
      evt.preventDefault();
	  });
	}
	
	window.onpopstate = function(event) {
	  var mapView = $('iframe#mapView').contents().get(0).defaultView;
	  if (event.state) {
	    mapView.q = event.state.q;
  	  mapView.l = event.state.l;
  	  mapView.loadResults()
  	  transitionToResults();
  	} else {
  	  mapView.clearResults();
  	  transitionToHome();
  	}
	}
	
	</script>
	
</head>

<body>

<div id="window">
  <div id='frame'>
    <iframe id='home' src='/home/home'></iframe>

    <iframe id='mapView' src='/search?utf8=✓&amp;delayLoad=true'></iframe>
  </div>
</div>

</body>
</html>