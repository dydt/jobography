<!DOCTYPE html>
<head>
<title>Jobography</title>
<style>

html {
  height: 100%;
}

body {
  margin: 0;
  height: 100%;
}

div#window {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

div#frame {
  width: 200%;
  height: 100%;
  position: relative;
}

iframe {
  width: 50%;
  height: 100%;
  border: none;
}

#home {	  
  float: left;
}

#mapView {
  float: left;
}

</style>
	
<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js'> </script>
	
<script>

var loading = false;
var spincount = 0;

function transitionToResults() {
  loading = false;
  $('div#frame').animate({
    left: '-100%'
  }, '700', function() {});
}

function transitionToHome() {
  $('div#frame').animate({
    left: '0%'
  }, '700', function() {});
}

function flipButton() {
  var home = $('iframe#home').contents().get(0);
  
  if (spincount > 10) {
    $('form', home).html("<span style='color:red'>" + 
        "Sorry, it looks like something went wrong &mdash; " +
        "please try again later.");
  }
  
  var t = (++spincount)%2 * 360;
  $('input.button', home).css('-webkit-transform', 'rotateY('+t+'deg)');
  if (loading) {
    setTimeout(flipButton, 1000);
  }
}


window.onload = function() {
  var home = $('iframe#home').contents().get(0);
  document.title = home.title;
  
  $('form', home).submit(function(evt) {
    loading = true;
    flipButton();
    
    var q = $('form input#q', home).val();
    var l = $('form input#l', home).val();
  
    mapView.q = q;
    mapView.l = l;
    
    mapView.loadResults();
    var url = '/search?q='+q+'&l='+l;
    history.pushState({q : q, l : l}, mapView.title, url);
  
    evt.preventDefault();
  });
}

window.onpopstate = function(event) {
  var mapView = $('iframe#mapView').contents().get(0).defaultView;
  if (event.state) {
    mapView.q = event.state.q;
	  mapView.l = event.state.l;
	  mapView.loadResults()
	  transitionToResults();
	} else {
	  mapView.clearResults();
	  transitionToHome();
	}
}

</script>
</head>

<body>

<div id="window">
  <div id='frame'>
    <iframe id='home' src='/home/home'></iframe>

    <iframe id='mapView' src='/search?delayLoad=true'></iframe>
  </div>
</div>

</body>
</html>